import { PermissionFlagsBits, SlashCommandBuilder, TextBasedChannel } from 'discord.js'
import { Command } from '@/types'
import { BAN } from '@/defines/commands.json'
import { PUNISHMENTS_CHANNEL } from '@/defines/ids.json'
import { embedTemplate } from '@/utils'

export const useBan = (): Command => {
  const data = new SlashCommandBuilder()
    .setName(BAN.TITLE)
    .setDescription(BAN.DESCRIPTION)
    .setDMPermission(false)
    .addUserOption((option) => option.setName('member').setDescription('Usu치rio a ser banido.').setRequired(true))
    .addStringOption((option) =>
      option.setName('reason').setDescription('Texto que ir치 aparecer no an칰ncio').setRequired(true)
    )
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator | PermissionFlagsBits.BanMembers)

  return [
    data,
    async (interaction, client) => {
      const author = interaction.user

      const user = interaction.options.getUser('member')
      const reason = interaction.options.get('reason')

      if (!user || !reason) {
        return
      }

      try {
        await interaction?.guild?.members.ban(user)
      } catch (e) {
        await interaction.reply({ content: 'O usu치rio em quest칚o n칚o pode ser banido!', ephemeral: true })

        return
      }

      const embed = embedTemplate({
        title: '``游뚮`` 췉 Puni칞칚o',
        target: {
          user,
          icon: true,
        },
        author,
        fields: [
          [
            { name: '``游녻`` **Usu치rio punido:**', value: `**${user!.username}**` },
            { name: '``游늯`` **Tipo:**', value: 'Banimento' },
            { name: '``游닊`` **Motivo:**', value: (reason.value as string) || 'N칚o Inferido.' },
          ],
        ],
      })

      const channel = (client.channels.cache.get(PUNISHMENTS_CHANNEL.id) as TextBasedChannel) || interaction.channel

      await channel?.send({ content: `Usu치rio ${user.id} Banido!`, embeds: [embed] })

      await interaction.reply({ content: 'Sucesso!', ephemeral: true })
    },
  ]
}
